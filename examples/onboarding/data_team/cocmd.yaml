name: data_team
automations:
  - name: onboarding
    content:
      description: "onboarding for example project https://github.com/dbt-labs/jaffle_shop"
      env: osx
      steps:
        - title: git
          runner: cocmd
          content: git.setup
        - title: python
          runner: cocmd
          content: python.setup
        - title: dbt
          runner: cocmd
          content: dbt.setup
        - title: docker
          runner: cocmd
          content: docker.setup
        - title: project clone
          runner: shell
          content: |
            mkdir -p ~/workspace
            cd  ~/workspace
            git clone git@github.com:dbt-labs/jaffle_shop.git

        - title: local docker
          runner: shell
          content: |
            # run local postgres docker with user alice and password alice-pass with port 5432
            docker run --rm --name jaffle_shop -e POSTGRES_USER=alice -e POSTGRES_PASSWORD=alice-pass -p 5432:5432 -d postgres
        
        - title: add profile to dbt
          runner: shell
          content: |
            mkdir -p ~/.dbt
            
            # check if jaffle_shop is in ~/.dbt/profiles.yml
            if grep -q jaffle_shop ~/.dbt/profiles.yml; then
              echo "jaffle_shop already in ~/.dbt/profiles.yml"
            else
              echo "jaffle_shop not in ~/.dbt/profiles.yml"
              cat <<EOF 
              
              jaffle_shop:
                target: dev
                outputs:
                  dev:
                    type: postgres
                    host: localhost
                    user: alice
                    password: alice-pass
                    port: 5432
                    dbname: jaffle_shop
                    schema: dbt_alice
                    threads: 4
              >> ~/.dbt/profiles.yml

        - title: dbt operations
          runner: shell
          content: |
            cd ~/workspace/jaffle_shop
            dbt deps
            dbt debug
            dbt seed
            dbt run
            dbt test
            dbt docs generate
            dbt docs serve
        